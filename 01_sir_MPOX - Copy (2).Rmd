---
title: "Simulating MPOX disease SIR dynamics"
author: "Shadrach Mintah, Benjamin Tommy Bavug, Kama Mary Ofuru, Victoria Nakalanzi"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
```

In this walk through, we will be simulating an SIR model.

The SIR model is a simple compartmental model used to describe the spread of MPOX, which is an infectious disease in a population. The model divides the population into three compartments: susceptible (S), infectious (I), and recovered (R) individuals. The model equations describe the flow of individuals between these compartments based on the transmission rate ($\beta$) and the recovery rate ($\gamma$).



## The model function

We have the following $assumptions$:

- The is natural immunity after recovery
- There is homogeneity of the population
- There is a constant removal rate due to other causes (1/10)
- Transmission is between human to huma contact



We start by defining the model equations.

The SIR model equations is given by:

\begin{align}
\frac{dS}{dt} & = \color{orange}{\frac{-\beta S I}{N}} \\
\frac{dI}{dt} & = \color{orange}{\frac{\beta S I}{N}} - \color{blue}{\gamma I} \\
\frac{dR}{dt} & = \color{blue}{\frac{\gamma I}{N}}
\end{align}

but

- $\beta$ = (b1 + b2 + b3)
- $\gamma$ = (y1 +y2)

where:

- $N$ is the population
- $S$ is the number of susceptible individuals,
- $I$ is the number of infectious individuals,
- $R$ is the number of removal individuals,
- $\beta$ is the transmission rate,
- $\gamma$ is the removal rate.
- $b1$ is the rate of transmission by sexual contact
- $b2$ is the rate of transmission by direct contact
- $b3$ is the rate of transmission by airborne
- $y1$ is the rate of removal due to mortality of other cause and migration
- $y2$ is the rate of removal due to recovered or died of MPOX

which translates into:

\begin{align}
\frac{dS}{dt} & = \color{orange}{-(b1 + b2 + b3) \frac{S I}{N}} \\
\frac{dI}{dt} & = \color{orange}{(b1 + b2 + b3) \frac{S I}{N}} - \color{blue}{(y1 + y2) I} \\
\frac{dR}{dt} & = \color{blue}{\frac{(y1 + y2) I}{N}}
\end{align}

where:
- $N$ is the population
- $S$ is the number of susceptible individuals,
- $I$ is the number of infectious individuals,
- $R$ is the number of removal individuals,
- $\beta$ is the transmission rate,
- $\gamma$ is the recovery rate.


## Model for children below 18yrs

```{r below_18yrs}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)


sir_model_u <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -(beta_a) * S * I
    dI <- (beta_a) * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}


# 2. Define the parameter 

# Using Nigeria
N  <- 220000000
N1 <- 95000000 # 45% of 220million are under 18years (Nigeria)
N2 <- 125000000 # 55% of 220million are above 18years (Nigeria)

I0 <- 20

# Initial conditions for S, I, R
inits <- c(S = N - I0, I = I0, R = 0)

R0 <- 1.5

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma/N

beta1 <- R0 * gamma/N #transmission rate for  direct and airborne contact
beta2 <- R0 * gamma/N2 #transmission rate for sexual contact




beta_a = beta1 + beta2

# beta_a=0.7
# bata=0.5
# The parameters
params <- c(
  beta = beta1,
  gamma = gamma
)

#3. Define the initial conditions


# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model_u,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot1 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model of MPOX (infection from people below 18years)",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot1)
```


```{r below_18yrs}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)


sir_model_u <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -(beta_a) * S * I
    dI <- (beta_a) * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}


# 2. Define the parameter 

# Using Nigeria
N  <- 220000000
N1 <- 95000000 # 45% of 220million are under 18years (Nigeria)
N2 <- 125000000 # 55% of 220million are above 18years (Nigeria)

I0 <- 20

# Initial conditions for S, I, R
inits <- c(S = N - I0, I = I0, R = 0)

R0 <- 1.5

# The infectious period is the average duration for which an individual remains infectious.
# infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
# gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
# beta <- R0 * gamma/N
# 
# beta1 <- R0 * gamma/N #transmission rate for  direct and airborne contact
# beta2 <- R0 * gamma/N2 #transmission rate for sexual contact




# beta_a = beta1 + beta2

beta_a = 0.0000000007
bata = 0.0000000005
gamma = 0.00007
# The parameters
params <- c(
  beta = beta_a,
  gamma = gamma
)

#3. Define the initial conditions


# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model_u,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot1 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model of MPOX (infection from people below 18years)",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot1)
```

## Model for adults above 18yrs


```{r coupled_model}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)



sir_model_c <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dSa <- (-(beta_a) * Sa * (Ia+Ic)/N2)
    dIa <- (beta_a) * Sa * (Ia+Ic)/N2  - gamma * (Ia)
    dRa <- gamma * Ia
    dSc <- -beta * Sc * (Ic+Ia)/N1
    dIc <- beta * Sc *(Ic+Ia)/N1 - gamma *(Ic)
    dRc <- gamma *(Ic)
    return(list(c(dSa, dSc, dIa, dIc, dRa, dRc)))
  })
}


I0 <- 20

Ia0=I0
Ic0=I0

# test=2*(beta_a) * (N2-20) * I0/N2 -gamma * (I0)

# 2. Define the parameter 

# Using Nigeria
N  <- 220000000
N1 <- 95000000 # 45% of 220million are under 18years (Nigeria)
N2 <- 125000000 # 55% of 220million are above 18years (Nigeria)

# Initial conditions for S, I, R
# inits <- c(S = N2 - I0, I = I0, R = 0)
inits <- c(Sa = N2 - Ia0, Ia = Ia0, Ra = 0, Sc = N1 - Ic0, Ic = Ic0, Rc = 0)

# R0 <- 1.5
# beta <- R0 * gamma/N

# beta1 <- R0 * gamma/N #transmission rate for  direct and airborne contact
# beta2 <- R0 * gamma/N2 #transmission rate for sexual contact

# beta_a = beta1 + beta2

beta = 0.5
beta_a = 0.9
gamma = 0.1

# The parameters
params <- c(
  beta = beta,
 beta_a = beta_a,
  gamma = gamma
)

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model_c,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:7),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot1 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model of MPOX (infection from coupled)",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot1)
```
## Trying the coupled model again

```{r coupled_model}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# # 1. Define the SIR model
# sir_model <- function(t, y, parms) {
#   with(as.list(c(y, parms)), {
#     dS <- -beta * S * I
#     dI <- beta * S * I - gamma * I
#     dR <- gamma * I
#     return(list(c(dS, dI, dR)))
#   })
# }
# 
# 
# sir_model_a <- function(t, y, parms) {
#   with(as.list(c(y, parms)), {
#     dS <- -(beta_a) * S * I
#     dI <- (beta_a) * S * I - gamma * I
#     dR <- gamma * I
#     return(list(c(dS, dI, dR)))
#   })
# }
# 
# sir_model_c <- function(t, y, parms) {
#   with(as.list(c(y, parms)), {
#     dSa <- -(beta_a) * Sa * (Ia+Ic)/125000000
#     dIa <- (beta_a) * Sa * (Ia+Ic)/125000000  -gamma * (Ia)
#     dRa <- gamma * Ia
#     dSc <- -beta * Sc * (Ic+Ia)/95000000
#     dIc <- beta * Sc *(Ic+Ia)/95000000 - gamma *(Ic)
#     dRc <- gamma *(Ic)
#     return(list(c(dSa, dSc, dIa, dIc, dRa, dRc)))
#   })
# }

sir_model_c <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dSa <- -(beta_a) * Sa
    dIa <- (beta_a) * Sa  - gamma
    dRa <- gamma * Ia
    dSc <- -beta * Sc 
    dIc <- beta * Sc - gamma
    dRc <- gamma
    return(list(c(dSa, dSc, dIa, dIc, dRa, dRc)))
  })
}


I0 <- 20

Ia0=I0
Ic0=I0

# test=2*(beta_a) * (N2-20) * I0/N2 -gamma * (I0)

# 2. Define the parameter 

# Using Nigeria
N  <- 220000000
N1 <- 95000000 # 45% of 220million are under 18years (Nigeria)
N2 <- 125000000 # 55% of 220million are above 18years (Nigeria)

# Initial conditions for S, I, R
# inits <- c(S = N2 - I0, I = I0, R = 0)
inits <- c(Sa = N2 - Ia0, Ia = Ia0, Ra = 0, Sc = N1 - Ic0, Ic = Ic0, Rc = 0)

R0 <- 1.5

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
# beta <- R0 * gamma/N
# 
# beta1 <- R0 * gamma/N #transmission rate for  direct and airborne contact
# beta2 <- R0 * gamma/N2 #transmission rate for sexual contact
# 
# beta_a = beta1 + beta2
# beta = beta1

beta = 0.5
beta_a = 0.7
# The parameters
params <- c(
  beta = beta,
 beta_a = beta_a,
  gamma = gamma
)

#3. Define the initial conditions


# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model_c,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:7),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot1 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model of MPOX (infection from coupled)",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot1)
```



```{r above_18yrs}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
sir_model <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# 2. Define the parameter 

R0 <- 1.5

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma/N

# The parameters
params <- c(
  beta = beta,
  gamma = gamma
)

#3. Define the initial conditions
N  <- 125000000
I0 <- 20

# Initial conditions for S, I, R
inits <- c(S = N - I0, I = I0, R = 0)

# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot1 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model of MPOX (non-children above 18yrs)",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot1)
```


```{r below_18yrs}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
# sir_model <- function(t, y, parms) {
#   with(as.list(c(y, parms)), {
#     dS <- -beta * S * I
#     dI <- beta * S * I - gamma * I
#     dR <- gamma * I
#     return(list(c(dS, dI, dR)))
#   })
# }


sir_model_u <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -(beta_a) * S * I
    dI <- (beta_a) * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# sir_model_a <- function(t, y, parms) {
#   with(as.list(c(y, parms)), {
#     dS <- -(beta_a) * S * I
#     dI <- (beta_a) * S * I - gamma * I
#     dR <- gamma * I
#     return(list(c(dS, dI, dR)))
#   })
# }


# 2. Define the parameter 

# Using Nigeria
N  <- 220000000
N1 <- 95000000 # 45% of 220million are under 18years (Nigeria)
N2 <- 125000000 # 55% of 220million are above 18years (Nigeria)

# Initial conditions for S, I, R
inits <- c(S = N - I0, I = I0, R = 0)

R0 <- 1.5

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma/N

beta1 <- R0 * gamma/N #transmission rate for  direct and airborne contact
beta2 <- R0 * gamma/N2 #transmission rate for sexual contact




beta_a = beta1 + beta2

beta_a=0.7
bata=0.5
# The parameters
params <- c(
  beta = beta1,
  gamma = gamma
)

#3. Define the initial conditions



I0 <- 20
# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model_u,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot1 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model of MPOX (infection from people below 18years)",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot1)
```

## R0 = c(1.1, 1.2, 1.5, 1.8, 2)
```{r}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
sir_model <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# 2. Define the parameter 

# List of R0 values to simulate
R0_values <- c(1.1, 1.2, 1.5, 1.8, 2)

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
gamma <- 1 / infectious_period

# 3. Define the initial conditions
N  <- 1
I0 <- 0.001
S0 <- N - I0
R0_init <- 0
inits <- c(S = S0, I = I0, R = R0_init)

# 4. Define the time points to return results
dt <- 1:365

# Load the necessary libraries
library(deSolve)
library(ggplot2)
library(tidyr)

# 5. Solve the model for each R0 and store the results
results_list <- lapply(R0_values, function(R0) {
  beta <- R0 * gamma
  params <- c(beta = beta, gamma = gamma)
  results <- deSolve::lsoda(y = inits, times = dt, func = sir_model, parms = params)
  results <- as.data.frame(results)
  results$R0 <- R0
  return(results)
})

# Combine all results into one data frame
all_results <- do.call(rbind, results_list)

# 6. Manipulate and interpret the results
# Create data for ggplot2 by reshaping
results_long <- all_results |>
  pivot_longer(
    cols = c(S, I, R),
    names_to = "compartment",
    values_to = "value"
  )

# Plot the results
sir_plot2 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = interaction(compartment, R0),
    group = interaction(compartment, R0)
  )
) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR Model for Different R0 Values",
    x = "Time",
    y = "Number of Individuals",
    color = "Compartment.R0"
  ) +
  theme_minimal()

# Display the plot
print(sir_plot2)
```


```{r}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
sir_model <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# 2. Define the parameter 

R0 <- 2

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 3
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma

# The parameters
params <- c(
  beta = beta,
  gamma = gamma
)

#3. Define the initial conditions
N  <- 1
I0 <- 0.01
# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot3 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot3)
```
```{r}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
sir_model <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# 2. Define the parameter 

R0 <- 2

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 10
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma

# The parameters
params <- c(
  beta = beta,
  gamma = gamma
)

#3. Define the initial conditions
N  <- 1
I0 <- 0.01
# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot4 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot4)
```

```{r}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
sir_model <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# 2. Define the parameter 

R0 <- 5

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma

# The parameters
params <- c(
  beta = beta,
  gamma = gamma
)

#3. Define the initial conditions
N  <- 1
I0 <- 0.01
# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot5 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot5)
```
```{r}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# 1. Define the SIR model
sir_model <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dS <- -beta * S * I
    dI <- beta * S * I - gamma * I
    dR <- gamma * I
    return(list(c(dS, dI, dR)))
  })
}

# 2. Define the parameter 

R0 <- 1

# The infectious period is the average duration for which an individual remains infectious.
infectious_period <- 14
# Remember gamma = 1/ infectious_period as discussed in the slides
gamma <- 1/infectious_period 

# The define beta, we will use the relation R0 = beta / gamma  because it is easier to interpret, that is, given an R0 and infectious period, we can calculate the corresponding beta value.
# beta is not directly interpretable because it is a composite of a number of factors.
beta <- R0 * gamma

# The parameters
params <- c(
  beta = beta,
  gamma = gamma
)

#3. Define the initial conditions
N  <- 1
I0 <- 0.01
# Initial conditions for S, I, R

# 4. Define the time points to return results
dt <- 1:365

#5. Solve the model
# Load the necessary libraries
library(deSolve)
# Solve the model
results <- deSolve::lsoda(
  y = inits,
  times = dt,
  func = sir_model,
  parms = params
)

#6. Manipulate and interpret the results
# Make it a data.frame
results <- as.data.frame(results)
head(results)

### Plotting the results

# Load the necessary libraries
library(ggplot2)
library(tidyr)
# Create data for ggplot2 by reshaping
results_long <- results |>
  pivot_longer(
    cols = c(2:4),
    names_to = "compartment",
    values_to = "value"
  )

sir_plot6 <- ggplot(
  data = results_long,
  aes(
    x = time,
    y = value,
    color = compartment
  )
  ) +
  geom_line(linewidth = 1) +
  labs(
    title = "SIR model",
    x = "Time",
    y = "Number of individuals"
  )
plot(sir_plot6)
```

## Exercise

Answer the following questions by adding code chunks and text chunks.


1. What do you observe from the plot above? Can you describe the dynamics of the SIR model?
```{r}
plot(sir_plot1)
```
**At day 1, All in the population was susceptible to the disease, 1 possibly infected person, and no recovered person in the population.
As the number of infected started to increase, the susceptible was reducing and the recovered also started increasing. At aroung day 70, the infection time reached a peak and began to fall. Those with the disease mostly recovered after day 100, with 20% of the population not getting the disease. After day 150, the in disease  was no spreading more in the population**

2. Change the value of the basic reproduction number ($R0$) to 3 and observe the effect on the dynamics of the SIR model.

** R0 = 3, infectious days =14**
```{r R0=3}
plot(sir_plot1)
```
** 

3. Plot the I compartments for different values of $R0$ (e.g., 1, 2, 3, 4, 5) on the same plot. What do you observe?
** R0 = 4 **
```{r R0 = 4}
plot(sir_plot2)
```


4. Change the value of the infectious period to 3 and 10 days and observe the effect on the dynamics of infection.
** Infectious days = 3, R0=2 **
```{r}
plot(sir_plot3)
```
** infectious days = 10, R0=2 **
```{r}
plot(sir_plot4)
```


5. What are the features of a disease that dies out quickly assuming $R0 > 1$?
** Infectious days = 14, r0 = 5 **
```{r}
plot(sir_plot5)
```


** Infectious days = 14, r0 = 1 **
```{r}
plot(sir_plot6)
```

